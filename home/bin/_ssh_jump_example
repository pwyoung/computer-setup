#!/bin/bash

# TODO: Set up PAM with Oauth2
# The agent connection can be hijacked
# on the target and used to connect elsewhere
setup_ssh_agent() {
    if ps eax | grep -v grep | grep -v defunct | awk '{print $5}' | egrep '^ssh-agent$'; then
	echo "ssh-agent is running"
	return
    else
	echo "Starting ssh-agent"
	eval $(ssh-agent)
    fi
}

add_ssh_keys_to_agent() {
    KEYS=(~/.ssh/id_ed25519-devops)
    #KEYS=$(ls -1 ~/.ssh/id_* | grep -v '.pub')
    
    for i in $KEYS; do	
	echo "Adding ssh key $i"
	ssh-add $i
    done    
}

#setup_ssh_agent
#add_ssh_keys_to_agent

#eval $(ssh-agent)

# ssh -A -i ~/.ssh/id_ed25519-devops ubuntu@54.158.37.44 'ssh ubuntu@10.0.1.164 hostname'
# ssh -J -A -i ~/.ssh/id_ed25519-devops ubuntu@54.158.37.44 ubuntu@10.0.1.164 hostname
